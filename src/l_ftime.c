//#define JD0 2451911 // ???? ?? 01 ??? 2001 ?? 
#define   JD0 2458850
#include "hw_rtc.h"
#define ddayCorr	-1

// ??????? ?????????????? ????????????? ???? ? ??????? ? ???????? ???????? 

unsigned int ftimeToCounter(ftime_t * ftime) { 
uint8_t a; uint16_t y; uint8_t m; uint32_t JDN; 
// ?????????? ??????????? ????????????? 
a=(14-ftime->month)/12; y=ftime->year+4800-a; m=ftime->month+(12*a)-3; 
// ????????? ???????? ???????? ?????????? ??? 
JDN=ftime->day; 
JDN+=(153*m+2)/5; JDN+=365*y; 
JDN+=y/4; 
JDN+=-y/100; 
JDN+=y/400; 
JDN+=-32045; 
JDN+=-JD0; 
// ??? ??? ??????? ? ??? ???????????, ?????? ??? ??????? ?????? ?? 01 ??? 2001 
JDN*=86400; 
// ????????? ??? ? ??????? 
JDN+=(ftime->hour*3600); 
// ? ????????? ??? ???????? ???????? ??? 
JDN+=(ftime->minute*60); 
JDN+=(ftime->second); 
// ????? ????? ?????????? ?????? ? 00-00 01 ??? 2001 
return JDN; } 

// ??????? ?????????????? ???????? ???????? ? ????????????? ???? ? ????? 
void counterToFtime(unsigned int counter,ftime_t * ftime) { 
unsigned int ace; unsigned char b; unsigned char d; unsigned char m; 
ace=(counter/86400)+32044+JD0; 
b=(4*ace+3)/146097; 
// ????? ?? ????????? ?????? ???????? ??-?? ???????????? 4*ace ?? 
ace=ace-((146097*b)/4); 
d=(4*ace+3)/1461; 
ace=ace-((1461*d)/4); 
m=(5*ace+2)/153; 
ftime->dayName = (ace + ddayCorr)% 7;
ftime->day=ace-((153*m+2)/5)+1; 
ftime->month=m+3-(12*(m/10)); 
ftime->year=100*b+d-4800+(m/10); 
ftime->hour=(counter/3600)%24; 
ftime->minute=(counter/60)%60; 
ftime->second=(counter%60); }